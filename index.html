<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herramienta del Vendedor: Decodificador de Pedidos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .container-box {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        .error-message {
            color: #ef4444;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container-box">
        <h1 class="text-3xl font-bold mb-6 text-gray-800">Decodificador y Generador de Pedidos</h1>
        <p class="mb-6 text-gray-600">Pega el mensaje de WhatsApp del cliente en el área de abajo. La herramienta decodificará automáticamente el pedido para su validación e importación.</p>

        <div class="mb-6 border-b pb-4">
            <label for="whatsapp-message" class="block text-lg font-medium text-gray-700 mb-2">1. Pegar Mensaje de WhatsApp</label>
            <textarea id="whatsapp-message" rows="5" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md p-3" placeholder="Pega el mensaje completo de WhatsApp aquí, incluyendo el código."></textarea>
            <button onclick="decodeAndProcess()" class="mt-3 w-full inline-flex items-center justify-center px-4 py-2 border border-transparent shadow-sm text-base font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Decodificar Pedido
            </button>
            <div id="status-message" class="mt-3 text-sm font-semibold"></div>
        </div>

        <div class="mb-6 border-b pb-4">
            <label for="client-name" class="block text-lg font-medium text-gray-700 mb-2">2. Asignar Cliente (Manual)</label>
            <input type="text" id="client-name" class="shadow-sm focus:ring-indigo-500 focus:border-indigo-500 mt-1 block w-full sm:text-sm border border-gray-300 rounded-md p-2" placeholder="Ej: Farmacia Central S.A. de C.V.">
        </div>

        <div class="mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-3">3. Revisión y Validación del Pedido</h2>
            <div id="order-review" class="overflow-x-auto shadow ring-1 ring-black ring-opacity-5 sm:rounded-lg">
                <table class="min-w-full divide-y divide-gray-300">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6">Código (SKU)</th>
                            <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Descripción (Simulada)</th>
                            <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Cantidad</th>
                            <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Validación</th>
                        </tr>
                    </thead>
                    <tbody id="order-table-body" class="divide-y divide-gray-200 bg-white">
                        <tr id="initial-row"><td colspan="4" class="px-6 py-4 text-sm text-gray-500 text-center">Aún no hay un pedido decodificado.</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="pt-4 border-t">
            <label class="block text-lg font-medium text-gray-700 mb-2">4. Generar Plantilla de Importación</label>
            <button onclick="downloadCSV()" id="download-button" class="w-full inline-flex items-center justify-center px-4 py-2 border border-transparent shadow-sm text-base font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500" disabled>
                Descargar Plantilla (CSV)
            </button>
        </div>
    </div>

    <script>
        // Catálogo de Productos NORVET 2025 (Datos extraídos del archivo PRECIOS NORVET 2025F AAP.xlsx - Hoja1.csv)
        // Cita de datos:
        const CATALOGO = {
            "A0003": { "desc": "CEFTRIA-PETS 50 mg NRV 10 ml.", "price": 142 },
            "A0004": { "desc": "CEFTRIA-JET 75 mg NRV 20 ml.", "price": 205 },
            "A0005": { "desc": "CEFTRIA-JET 75 mg NRV 100 ml.", "price": 790 },
            "A0006": { "desc": "CLINDA- JET 100 mg/ml. 25 ml.", "price": 435 },
            "A0007": { "desc": "FLOXI-JET 5% INY. NRV. 20 ml.", "price": 107 },
            "A0010": { "desc": "FLOXI-JET 10% INY. NRV. 250 ml.", "price": 756 },
            "A0015": { "desc": "FLUVI-JET PLUS L.A 6 mill", "price": 242 },
            "A0019": { "desc": "GENTA-JET 100 NRV. 100 ml.", "price": 429 },
            "A0023": { "desc": "GENTY- JET NRV. 250 ml.", "price": 1354 },
            "A0025": { "desc": "OXYJET NRV-50 100 ml.", "price": 165 },
            "A0026": { "desc": "OXYJET NRV-50 500 ml.", "price": 571 },
            "A0032": { "desc": "TYLO-JET NRV. 250 ml.", "price": 676 },
            "A0033": { "desc": "TYLOFOS JET NRV* 1.5 15 ml.", "price": 76 },
            "A0034": { "desc": "TYLOFOS JET INY 50 ml. (1ml x 1.5kg)", "price": 287 },
            "A0035": { "desc": "TYLOFOS JET NRV* 1.5 100 ml.", "price": 474 },
            "A0040": { "desc": "TYANFENI JET NRV 250 ml.", "price": 1577 },
            "A0044": { "desc": "TILMICO-JET NRV 250 ml.", "price": 2779 },
            "A0048": { "desc": "FLOXI-JET PLUS NRV. 30 ml.", "price": 105 },
            "A0050": { "desc": "SULTRIM NRV PREMIX 5 kg.", "price": 2145 },
            "A0055": { "desc": "AMOXI PET´S NRV 125 mg 30 Tabs.", "price": 230 },
            "A0056": { "desc": "AMOXI PET´S NRV 250 mg 30 Tabs.", "price": 426 },
            "A0057": { "desc": "AMO-PET´S NRV Susp. Oral 14 ml.", "price": 107 },
            "A0058": { "desc": "AMO-PET´S NRV Susp. Oral 28 ml.", "price": 133 },
            "A0059": { "desc": "AZITROMI-PETS NRV Susp. Oral. 20 ml.", "price": 190 },
            "A0061": { "desc": "AZITROMI-PETS NRV Tabletas M 7 tabs.", "price": 278 },
            "A0062": { "desc": "AZITROMI-PETS NRV Tabletas L 7 tabs.", "price": 370 },
            "A0063": { "desc": "CLAMOXIL NRV Susp. Oral 33 ml.", "price": 266 },
            "A0064": { "desc": "CEFA-PETS NRV S 30 Tabs.", "price": 211 },
            "A0065": { "desc": "CEFA-PETS NRV M 30 Tabs.", "price": 360 },
            "A0066": { "desc": "CEFA-PET'S NRV \" L\" 30 Tabs.", "price": 529 },
            "A0067": { "desc": "CEFA-PETS NRV XL 20 Tabs.", "price": 520 },
            "A0068": { "desc": "FLOXI-PET´S NRV 50 mg. 30 Tabs.", "price": 284 },
            "A0069": { "desc": "FLOXI-PETS NRV 150 mg. 30 Tabs.", "price": 709 },
            "A0070": { "desc": "DOXI PETS S NRV 30 TAB", "price": 227 },
            "A0071": { "desc": "DOXI PETS S NRV 50 mg. 240 tabs", "price": 1532 },
            "A0072": { "desc": "DOXI PETS M NRV 30 Tab", "price": 293 },
            "A0073": { "desc": "DOXI PETS M NRV 100 mg. 240 tabs", "price": 2051 },
            "A0074": { "desc": "DOXI PETS L NRV 30 Tabs", "price": 506 },
            "A0075": { "desc": "DOXI PETS L NRV 250 mg. 240 tabs", "price": 3582 },
            "A0076": { "desc": "DOXI PETS XL NRV 30 Tab", "price": 783 },
            "A0077": { "desc": "DOXI PETS XL NRV 500 mg. 240 tabs", "price": 5588 },
            "A0078": { "desc": "CLINDA - PETS S 25 mg. 30 Tabs.", "price": 190 },
            "A0079": { "desc": "CLINDA - PETS M 50 mg. 30 Tabs.", "price": 309 },
            "A0080": { "desc": "CLINDA - PETS L 125 mg. 30 Tabs.", "price": 547 },
            "A0081": { "desc": "CLINDA - PETS XL 200 mg. 30 Tabs.", "price": 827 },
            "A0082": { "desc": "CLINDA - PETS SUSP. ORAL 25mg/ml. 25 ml.", "price": 331 },
            "A0083": { "desc": "SULFATRIM-PETS 40 mg. Suspensión Oral 60 ml.", "price": 165 },
            "A0084": { "desc": "SULFATRIM-PETS 80 mg. Suspensión Oral 60 ml.", "price": 261 },
            "A0087": { "desc": "GENTYMAST Mastitis 24 x 8 gr.", "price": 1335 },
            "A0088": { "desc": "MASTIVAC NRV Mastitis 24 x 8 gr.", "price": 1546 },
            "A0091": { "desc": "CLOXIDRY 800 NRV Secado 24 x 5 gr.", "price": 1338 },
            "A0103": { "desc": "CEFTIO-JET 5% NRV 250 ml.", "price": 1571 },
            "A0110": { "desc": "FLORFENI-JET NRV DX 250 ml", "price": 1804 },
            "A0123": { "desc": "SULFA-JET NRV 100 ML", "price": 600 },
            "A0124": { "desc": "SULFA-JET NRV 250 ML", "price": 1102 },
            "A0132": { "desc": "SULFA-JET NRV 15 ML", "price": 128 },
            "A0141": { "desc": "SECA-JET NRV Secado 24 x 10 gr.", "price": 2405 },
            "A0148": { "desc": "TULAX NRV 500 ml.", "price": 18318 },
            "AN0002": { "desc": "PRODOL-JET NRV. 100 ml.", "price": 189 },
            "AN0003": { "desc": "PRODOL-JET NRV. 250 ml.", "price": 376 },
            "AN0004": { "desc": "DEXA-JET NRV 15 ml.", "price": 76 },
            "AN0006": { "desc": "DEXA-JET NRV 100 ml.", "price": 299 },
            "AN0007": { "desc": "PREDNI - PETS 5 mg. 30 Tabs. S", "price": 233 },
            "AN0008": { "desc": "PREDNI - PETS 12.5 mg. 30 Tabs. M", "price": 316 },
            "AN0009": { "desc": "PREDNI - PETS 25 mg. 30 Tabs. L", "price": 379 },
            "AN0010": { "desc": "PREDNI - PETS 50 mg. 30 Tabs. XL", "price": 663 },
            "AN0011": { "desc": "MELOXI - PETS S 1 mg. (1 x 10 kg) 30 Tabs.", "price": 442 },
            "AN0012": { "desc": "MELOXI - PETS M 2.5 mg. (1 x 25 kg) 30 Tabs.", "price": 616 },
            "AN0013": { "desc": "MELOXI - PETS L 4 mg.(1 x 40 kg) 30 Tabs.", "price": 790 },
            "AN0014": { "desc": "MELOXI - PETS XL 5 mg. (1 x 50 kg) 30 Tabs.", "price": 883 },
            "AN0015": { "desc": "MELOXI - PETS 1.5 mg. Susp. Oral 50 ml.", "price": 631 },
            "AN0016": { "desc": "MELOXI - JET 2 mg. inyectable Peq. Esp. 20 ml.", "price": 426 },
            "AN0017": { "desc": "MELOXI - JET 5 mg. inyectable Peq. Esp. 20 ml.", "price": 623 },
            "AN0018": { "desc": "MELOXI - JET inyectable 25 mg. 100 ml.", "price": 947 },
            "AN0020": { "desc": "DICLO JET NRV 5% 100 ml.", "price": 591 },
            "AN0028": { "desc": "FLUNIXIN-JET NRV 8.3% 250 ml.", "price": 2176 },
            "AN0037": { "desc": "TRAMADOL PETS S 10 mg 10 TABS ( 1 X 2.5 Kg)", "price": 182 },
            "AN0038": { "desc": "TRAMADOL PETS M 20 mg 10 TABS ( 1 X 5 Kg)", "price": 234 },
            "AN0039": { "desc": "TRAMADOL PETS L 40 mg 10 TABS ( 1 X 10 Kg)", "price": 316 },
            "AN0040": { "desc": "TRAMADOL PETS XL 100 mg 10 TABS ( 1 X 25 Kg)", "price": 421 },
            "AN0042": { "desc": "TRAMADOL PETS Sol Oral 30 ml. 20 mg ( 1 ml X 5 Kg)", "price": 379 },
            "AN0043": { "desc": "TRAMADOL JET NRV 30 ml SOL INY (20mg x ml)", "price": 474 },
            "AN0049": { "desc": "PRODOL JET PLUS SOL. INY. 100 ML", "price": 455 },
            "AN0050": { "desc": "PRODOL PETS PLUS SOL. ORAL 30 ML", "price": 173 },
            "AN0051": { "desc": "TRAMA PET'S PLUS XS 10 TABS", "price": 205 },
            "AN0052": { "desc": "TRAMA PET'S PLUS S 10 TABS", "price": 266 },
            "AN0053": { "desc": "TRAMA PET'S PLUS NRV M 10 TABS", "price": 331 },
            "AN0054": { "desc": "TRAMA PET'S PLUS L 10 TABS", "price": 395 },
            "AN0062": { "desc": "GABAPENTIN S NRV 50 mg 30 tabs", "price": 198 },
            "AN0063": { "desc": "GABAPENTIN M NRV 100 mg 30 tabs", "price": 299 },
            "AN0064": { "desc": "GABAPENTIN L NRV 250 mg 30 tabs", "price": 479 },
            "AN0065": { "desc": "GABAPENTIN XL NRV 400 mg 30 tabs", "price": 697 },
            "AN0066": { "desc": "XILACINA 10 % 50 ML", "price": 1040 },
            "AN0067": { "desc": "XILACINA 2 % 25 ML", "price": 545 },
            "B0001": { "desc": "PEEK´ N- RB Rabia 12 unidosis", "price": 621 },
            "B0002": { "desc": "PEEK´ CPV 12 unidosis", "price": 926 },
            "B0004": { "desc": "PEEK´ N-Puppy 12 unidosis", "price": 1211 },
            "B0005": { "desc": "PEEK´ N-5 12 unidosis", "price": 1275 },
            "B0006": { "desc": "PUPPY JET N3 NRV + Diluente estéril 12 unidosis", "price": 1911 },
            "B0007": { "desc": "PUPPY JET N5 NRV + Diluente Lepto 6 12 unidosis", "price": 1976 },
            "B0011": { "desc": "RODEO 3 VIAS + SOMNUS 50 ml", "price": 131 },
            "B0012": { "desc": "RODEO 3 VIAS + SOMNUS 100 ml.", "price": 245 },
            "B0013": { "desc": "RODEO 3 VIAS + SOMNUS 250 ml.", "price": 541 },
            "B0014": { "desc": "RODEO 8 VIAS 50 ml", "price": 144 },
            "B0015": { "desc": "RODEO 8 VIAS 100 ml.", "price": 245 },
            "B0016": { "desc": "RODEO 8 VIAS 250 ml.", "price": 561 },
            "B0020": { "desc": "LEPTO H BOVIS NRV 50 ds", "price": 1690 },
            "B0023": { "desc": "DERRIGAN NRV. 11.ds.", "price": 190 },
            "B0024": { "desc": "RODEO VIRAL 2 NRV 50 ml", "price": 362 },
            "B0025": { "desc": "RODEO VIRAL 2 NRV 250 ml", "price": 1655 },
            "B0026": { "desc": "RODEO VIRAL 4 + LHB NRV 50 ml", "price": 506 },
            "B0027": { "desc": "RODEO VIRAL 4 + LHB NRV 250 ml", "price": 2369 },
            "B0030": { "desc": "RODEO 1 PHM + HEM 50 ml", "price": 316 },
            "B0034": { "desc": "RODEO 11 VIAS 50 ml.", "price": 186 },
            "B0035": { "desc": "RODEO 11 VIAS 100 ml.", "price": 334 },
            "B0036": { "desc": "RODEO 11 VIAS 250 ml.", "price": 747 },
            "B0067": { "desc": "DERRIGAN NRV. 20 ds.", "price": 308 },
            "C0001": { "desc": "CONDRO JET NRV (INYECTABLE) 10 ml.", "price": 1388 },
            "C0002": { "desc": "CARTI PETS 25 30 Tabs.", "price": 987 },
            "C0003": { "desc": "CARTI-PETS PLUS 25 (Con Meloxicam) 30 Tabs. 2.5GRS", "price": 1278 },
            "C0004": { "desc": "CARTI PETS PLUS 10 NRV 30 Tabs.", "price": 732 },
            "C0006": { "desc": "CARTRY-JET 6 ML", "price": 2171 },
            "C0007": { "desc": "CARTRY-JET 8 ML", "price": 2603 },
            "C0008": { "desc": "CARTRY-JET 4 ML", "price": 1405 },
            "C0009": { "desc": "CARPRO PET´S S 30 TABS", "price": 460 },
            "C0010": { "desc": "CARPRO PET´S M 30 TABS", "price": 545 },
            "C0011": { "desc": "CARPRO PET´S L 30 TABS", "price": 1023 },
            "C0012": { "desc": "CARTI PET´S C 10 30 TABS ( Con Carprofeno)", "price": 896 },
            "C0013": { "desc": "CARTI PET´S C 25 30 TABS (Con Carprofeno)", "price": 1421 },
            "C0014": { "desc": "CARTI PETS 10 NRV 30 Tab", "price": 561 },
            "C0021": { "desc": "DOLOCAR PLUS NRV S 10 Tabs", "price": 151 },
            "C0022": { "desc": "DOLOCAR PLUS NRV* M 10 Tabs.", "price": 189 },
            "C0023": { "desc": "DOLOCAR PLUS NRV L 10 Tabs", "price": 353 },
            "C0024": { "desc": "DOLOCAR PLUS NRV XL 10 Tabs", "price": 653 },
            "CA0001": { "desc": "RAMIPRIL PLUS 5 NRV 30 Tabs.", "price": 474 },
            "CA0002": { "desc": "RAMIPRIL PLUS 10 30 Tabs.", "price": 663 },
            "CA0003": { "desc": "RAMIPRIL PLUS 20 NRV* 30 Tabs.", "price": 804 },
            "CA0005": { "desc": "RAMIPRIL NRV S 30 Tabs.", "price": 331 },
            "CA0006": { "desc": "RAMIPRIL NRV M 30 Tabs.", "price": 568 },
            "CA0007": { "desc": "RAMIPRIL NRV L 30 Tabs.", "price": 916 },
            "CA0017": { "desc": "SILDENA PETS S 10 Tabs", "price": 114 },
            "CA0018": { "desc": "SILDENA PETS M 10 Tabs", "price": 149 },
            "CA0019": { "desc": "PIMO PETS S NRV 1.25mg 30 tabs.", "price": 385 },
            "CA0020": { "desc": "PIMO PETS M NRV 2.5 mg 30 tabs.", "price": 482 },
            "D0001": { "desc": "GIARDICOX NRV M 250 MG 20 TABS.", "price": 421 },
            "D0002": { "desc": "GIARDICOX NRV Suspensión Oral 20 ml.", "price": 242 },
            "D0003": { "desc": "GIARDICOX NRV Suspensión Oral 50 ml.", "price": 342 },
            "D0004": { "desc": "METRONIDA PET´S 150 mg/ml 15 ml.", "price": 105 },
            "D0005": { "desc": "METRONIDA PET´S 150 mg/ml 30 ml.", "price": 135 },
            "D0006": { "desc": "METRONIDA PET´S 150 mg/ml 120 ml.", "price": 362 },
            "D0007": { "desc": "COMPLET PLUS SUSP ORAL 15 ml.", "price": 129 },
            "D0008": { "desc": "COMPLET PLUS SUSP ORAL 30 ml.", "price": 182 },
            "D0009": { "desc": "COMPLET PLUS SUSP ORAL 120 ml.", "price": 599 },
            "D0010": { "desc": "COMPLET PLUS SUSP ORAL 1 lto", "price": 4340 },
            "D0011": { "desc": "COMPLET PLUS S NRV 30 Tabs.", "price": 474 },
            "D0012": { "desc": "COMPLET PLUS M NRV 30 Tabs.", "price": 663 },
            "D0013": { "desc": "COMPLET PLUS L NRV 20 Tabs.", "price": 860 },
            "D0014": { "desc": "EQUIPASTA (UNA DOSIS) 10 gr.", "price": 195 },
            "D0016": { "desc": "EQUINOX PLUS PASTA (600 kg) 30 gr.", "price": 316 },
            "D0018": { "desc": "IVER PET'S PLUS S 30 Tabs.", "price": 442 },
            "D0020": { "desc": "IVER PETS PLUS L 30 Tabs.", "price": 1199 },
            "D0024": { "desc": "IMIDO-JET 150 mg. 15 ml.", "price": 287 },
            "D0025": { "desc": "IMIDO-JET 150 mg. 100 ml.", "price": 1647 },
            "D0026": { "desc": "NORALBEN 2.5% 200 ml.", "price": 219 },
            "D0030": { "desc": "NORALBEN 10% Co. 1 lt.", "price": 1494 },
            "D0037": { "desc": "OROL-JET 12% + B COMPLEX. 500 ml.", "price": 676 },
            "D0041": { "desc": "IVER NRV AS 15 ml.", "price": 70 },
            "D0043": { "desc": "IVER NRV AS 100 ml.", "price": 402 },
            "D0045": { "desc": "IVER NRV AS 500 ml.", "price": 1608 },
            "D0046": { "desc": "IVER + A D E NRV 15 ml.", "price": 105 },
            "D0047": { "desc": "IVER + A D E NRV 50 ml.", "price": 292 },
            "D0048": { "desc": "IVER + A D E NRV 100 ml.", "price": 560 },
            "D0049": { "desc": "IVER + A D E NRV 250 ml.", "price": 1277 },
            "D0050": { "desc": "IVER + A D E NRV 500 ml.", "price": 2218 },
            "D0064": { "desc": "COXI PET´S 5% 30 ML", "price": 287 },
            "D0070": { "desc": "COXI JET SUS. ORAL 5% 1 LT", "price": 5051 },
            "D0072": { "desc": "GIARDICOX XL 20 TABS", "price": 853 },
            "D0073": { "desc": "GIARDICOX S 20 TABS", "price": 196 },
            "D0078": { "desc": "COMPLET PLUS NRV XL 4 TABS ( 1 X 40 KGS)", "price": 266 },
            "D0087": { "desc": "METRONIDA PETS 50 mg/ml 30 ml.", "price": 95 },
            "D0088": { "desc": "FEBEN 10 NRV 100 ml", "price": 161 },
            "D0089": { "desc": "FEBEN 10 NRV 1 lt.", "price": 1260 },
            "D0091": { "desc": "COMPLET MAX S 30 TABS", "price": 510 },
            "D0092": { "desc": "COMPLET MAX M 20 TABS", "price": 852 },
            "D0095": { "desc": "COMPLET PLUS GATOS NRV Susp oral. 30 ml", "price": 128 },
            "D0096": { "desc": "COMPLET MAX NRV Susp oral. 30 ml", "price": 567 },
            "D0097": { "desc": "COMPLET MAX NRV Susp oral. 120 ml", "price": 922 },
            "D0098": { "desc": "COMPLET MAX NRV Susp oral. 1 L", "price": 5957 },
            "DI0001": { "desc": "URANOTEST PARVO-CORONA 5 pruebas", "price": 2017 },
            "DI0002": { "desc": "URANOTEST MOQUILLO-ADENOVIRUS 5 pruebas", "price": 2017 },
            "DI0003": { "desc": "URANOTEST QUATTRO 5 pruebas", "price": 2691 },
            "DI0004": { "desc": "URANOTEST FeLV-FIV 5 pruebas", "price": 2017 },
            "DI0005": { "desc": "URANOTEST PARVO-CORONA 10 pruebas", "price": 3552 },
            "DI0006": { "desc": "URANOTEST PARVO-CORONA GIARDIA 5 pruebas", "price": 2398 },
            "DI0007": { "desc": "URANOTEST QUATTRO 10 pruebas", "price": 4836 },
            "DI0008": { "desc": "URANOTEST COPRO 10 pruebas.", "price": 2961 },
            "DI0009": { "desc": "URANOTEST DERMATOFITOS 4 test", "price": 2073 },
            "E0009": { "desc": "PROTECTO FI SHAMPOO 250 ML", "price": 202 },
            "E0020": { "desc": "PROTECTO MAX NRV S 1 tab", "price": 642 },
            "E0021": { "desc": "PROTECTO MAX NRV M 1 tab", "price": 749 },
            "E0022": { "desc": "PROTECTO MAX NRV L 1 tab", "price": 856 },
            "F0002": { "desc": "AZULVET NRV. 100 ml.", "price": 55 },
            "F0003": { "desc": "AZULVET CON ATOMIZADOR 100 ml.", "price": 71 },
            "F0004": { "desc": "AZULVET EN AEROSOL 375 ml.", "price": 226 },
            "F0005": { "desc": "CAL-PRIME NRV 500 ml.", "price": 273 },
            "F0006": { "desc": "KETOCONA-PETS NRV 100 mg. 30 Tabs.", "price": 266 },
            "F0007": { "desc": "ITRACONAPETS 25 mg. 20 caps", "price": 251 },
            "F0008": { "desc": "ITRACONAPETS 50 mg. 20 caps", "price": 379 },
            "F0009": { "desc": "ITRACONAPETS 125 mg. 20 caps", "price": 550 },
            "F0016": { "desc": "MAMI JET NRV 200 gr.", "price": 253 },
            "F0018": { "desc": "BISMU-JET NRV 120 ml.", "price": 102 },
            "F0019": { "desc": "BISMU-JET NRV 2 litros", "price": 709 },
            "F0020": { "desc": "STOP-JET NRV 120 ml.", "price": 102 },
            "F0021": { "desc": "STOP-JET NRV 2 litros", "price": 752 },
            "F0023": { "desc": "CISA PETS 5 mg. (Cisaprida) 1 tab/10kg 10 tabs", "price": 142 },
            "F0024": { "desc": "CISA PETS 10 mg (Cisaprida) 1 tab/20 kg 10 tabs.", "price": 251 },
            "F0025": { "desc": "VOMI - PETS NRV 15 ml.", "price": 95 },
            "F0026": { "desc": "VOMI - PETS NRV 50 ml.", "price": 316 },
            "F0027": { "desc": "RANITI - PETS 15 ml.", "price": 85 },
            "F0028": { "desc": "RANITI - PETS 50 ml.", "price": 266 },
            "F0029": { "desc": "OMEPRA-JET NRV Inyectable 10 ml.", "price": 293 },
            "F0030": { "desc": "OMEPRA PETS 5 mg. 20 caps", "price": 227 },
            "F0031": { "desc": "OMEPRA PETS 21mg. 10 caps", "price": 173 },
            "F0032": { "desc": "FUROSI PETS 6 MG \"S\" 20 TABS", "price": 150 },
            "F0033": { "desc": "FUROSI PETS 28 MG \"M\" 20 TABS", "price": 196 },
            "F0034": { "desc": "FUROSI PETS 50 MG \"L\" 20 TABS", "price": 227 },
            "F0035": { "desc": "FUROSI PETS 100 MG \"XL\" 20 TABS", "price": 348 },
            "F0036": { "desc": "FLUCONA PET´S S 10 TABS", "price": 234 },
            "F0037": { "desc": "FLUCONA PET´S M 10 TABS", "price": 387 },
            "F0038": { "desc": "FLUCONA PET´S L 10 TABS", "price": 609 },
            "F0043": { "desc": "ONDRA JET 2 NRV 10 x 2 ml.", "price": 1177 },
            "F0044": { "desc": "ONDRA JET 2 NRV 20 ML", "price": 1152 },
            "F0048": { "desc": "RANITI PET´S NRV SOLUCION ORAL", "price": 120 },
            "F0050": { "desc": "DERMA CREM NRV", "price": 135 },
            "F0051": { "desc": "CAL-PRIME MG NRV", "price": 273 },
            "F0061": { "desc": "FUROSI JET NRV 20 ML", "price": 234 },
            "F0063": { "desc": "CISA PET`S NRV Suspension 40 ml", "price": 251 },
            "F0066": { "desc": "NET PET NRV 30 TABS", "price": 210 },
            "F0072": { "desc": "OMEPRA JET 6 X 1 ml", "price": 482 },
            "H0001": { "desc": "TYRO- PET´S 0.2 MG NRV 30 TAB", "price": 138 },
            "H0002": { "desc": "TYRO- PET´S 0.4 MG NRV 30 TAB", "price": 158 },
            "H0003": { "desc": "TYRO- PET´S 0.6 MG NRV 30 TAB", "price": 189 },
            "H0004": { "desc": "TYRO-PET´S 0.8 MG NRV 30 TAB", "price": 227 },
            "H0005": { "desc": "EXPUL-JET 20 NRV. 15 ml.", "price": 107 },
            "H0007": { "desc": "EXPUL-JET 20 NRV. 250 ml.", "price": 435 },
            "H0008": { "desc": "SYNCRO-JET NRV. 20 ml.", "price": 621 },
            "H0009": { "desc": "SYNCRO-JET NRV. 50 ml.", "price": 1242 },
            "H0011": { "desc": "E-NRV 10 ml.", "price": 138 },
            "H0012": { "desc": "CARBETO-JET NRV 10 ml.", "price": 266 },
            "H0013": { "desc": "FERTY-JET NRV 50 ml.", "price": 1639 },
            "H0016": { "desc": "TRILOSTANO 10 mg NRV 30 tabs", "price": 1088 },
            "H0018": { "desc": "TRILOSTANO 60mg NRV 30 tabs", "price": 1671 },
            "I003": { "desc": "DERMATOPIC 50 mg. 30 ml.", "price": 1703 },
            "I004": { "desc": "DERMATOPIC 50 mg. 120 ml.", "price": 5720 },
            "I005": { "desc": "BROMO K Pets S 30 tabs", "price": 161 },
            "I006": { "desc": "BROMO K Pets M 30 tabs", "price": 257 },
            "I007": { "desc": "BROMO K Pets L 30 tabs", "price": 342 },
            "I008": { "desc": "BROMO K Pets XL 30 tabs", "price": 749 },
            "N0001": { "desc": "NRV-4 Pasta 300 gr.", "price": 1208 },
            "N0003": { "desc": "LACTO PETS NRV 450 gr.", "price": 363 },
            "N0004": { "desc": "ALKARUMEN NRV 40 x 10 gr.", "price": 1283 },
            "O0004": { "desc": "OTIPETS NRV 100 ml.", "price": 143 },
            "O0006": { "desc": "OTIC - NRV 15 ml", "price": 181 },
            "O0012": { "desc": "REPELENTE CHUSCALE EN ATOMIZADOR 250 ml", "price": 322 },
            "OF0001": { "desc": "OFTI-JET UNGËNTO 7.5gr.", "price": 601 },
            "OF0002": { "desc": "OFTI - PETS GOTAS 5 ml.", "price": 393 },
            "OF0003": { "desc": "TOBRA PET'S NRV 10 ml.", "price": 174 },
            "OF0004": { "desc": "TOBRA PET´S DEXA OFTALMICO NRV 10 ml.", "price": 259 },
            "OF0005": { "desc": "DICLO PET´S NRV", "price": 143 },
            "OF0006": { "desc": "PREDNI PET´S NRV oftalmico", "price": 158 },
            "OF0008": { "desc": "LUBRI - PET´S NRV Solución Oftalmica 10 ml.", "price": 158 },
            "OF0009": { "desc": "LUBRI - PETS UNGÜENTO 7.5 gr.", "price": 158 },
            "OF0014": { "desc": "CONDRO PETS LAGRIMA 10 ml", "price": 315 },
            "OF0015": { "desc": "TOBRA PETS PLUS 10 ml", "price": 560 },
            "S0002": { "desc": "OSO PETS NRV 250 ml.", "price": 151 },
            "S0003": { "desc": "OSO PETS NRV 4 lts.", "price": 2046 },
            "S0009": { "desc": "FUNGI-PETS OIL NRV 250 ml.", "price": 315 },
            "S0011": { "desc": "FUNGI-PETS DRY NRV 250 ml.", "price": 315 },
            "S0012": { "desc": "PEROXIBEN PETS NRV 237 ml.", "price": 242 },
            "S0013": { "desc": "SARNIPETS NRV 250 ml.", "price": 242 },
            "V0002": { "desc": "SEL + E NRV 100 ml.", "price": 366 },
            "V0003": { "desc": "SEL + E NRV 250 ml.", "price": 778 },
            "V0005": { "desc": "ENER-JET ADE NRV. 100 ml.", "price": 284 },
            "V0006": { "desc": "ENER-JET ADE NRV. 500 ml.", "price": 1023 },
            "V0010": { "desc": "ENER-JET B COMPLEX NRV. 30 ml.", "price": 104 },
            "V0011": { "desc": "ENER-JET B COMPLEX NRV. 100 ml.", "price": 168 },
            "V0012": { "desc": "ENER-JET B COMPLEX NRV. 250 ml.", "price": 334 },
            "V0013": { "desc": "GALLO-JET NRV 120 Tabs", "price": 347 },
            "V0014": { "desc": "CYANO-JET B12 6000 5 ml.", "price": 152 },
            "V0015": { "desc": "CYANO-JET B12 6000 30 ml.", "price": 406 },
            "V0016": { "desc": "CYANO-JET B12 6000 100 ml.", "price": 1003 },
            "V0017": { "desc": "ENER-JET LITE NRV 500 ml.", "price": 197 },
            "V0018": { "desc": "MASKO PETS Ca. 30 tabs", "price": 253 },
            "V0019": { "desc": "MASKO PETS PLUS. 30 tabs", "price": 253 },
            "V0022": { "desc": "ENERGY PET´S GEL 150 GR", "price": 308 },
            "V0024": { "desc": "ENER-JET LITE PLUS NRV 500ML", "price": 207 },
            "V0025": { "desc": "ENER JET LITE PLUS NRV CABALLOS 500 ML CJA", "price": 242 },
            "V0026": { "desc": "ENERGY PET´S GEL 60 GR", "price": 247 },
            "V0028": { "desc": "OMEGA PET'S 30 TABS ( MASTICABLES)", "price": 332 },
            "V0029": { "desc": "APPETIT PET'S NRV 30 ML GOTERO", "price": 223 },
            "V0035": { "desc": "FOSFO JET TONIC NRV 100 ML", "price": 520 },
            "V0036": { "desc": "FOSFO JET TONIC NRV 250 ML", "price": 1183 },
            "V0041": { "desc": "VITANEGRA NRV PREMIUM 10 x 15ml.", "price": 865 },
            "V0042": { "desc": "VITANEGRA NRV PREMIUM 30 ML", "price": 147 },
            "V0043": { "desc": "VITANEGRA NRV PREMIUM 50 ML", "price": 219 },
            "V0044": { "desc": "VITANEGRA NRV PREMIUM 100 ML", "price": 348 },
            "V0045": { "desc": "VITANEGRA NRV PREMIUM 250 ML", "price": 852 }
        };

        let decodedOrder = [];

        // Función de utilidad para decodificar una línea de texto de pedido.
        function decodeLine(line) {
            const regex = /([a-zA-Z]{1}\d{4}[a-zA-Z]*)\s?x\s?(\d+)/i;
            const match = line.match(regex);
            
            if (match) {
                const sku = match[1].toUpperCase();
                const quantity = parseInt(match[2], 10);
                
                // Buscar en el catálogo
                const productInfo = CATALOGO[sku];
                
                if (productInfo) {
                    return {
                        sku: sku,
                        quantity: quantity,
                        price: productInfo.price,
                        desc: productInfo.desc,
                        validation: "✅ OK"
                    };
                } else {
                    return {
                        sku: sku,
                        quantity: quantity,
                        price: 0,
                        desc: "SKU NO ENCONTRADO",
                        validation: "⚠️ ERROR: SKU Desconocido"
                    };
                }
            }
            return null; // Línea que no coincide con el formato
        }

        // Función principal de procesamiento
        function decodeAndProcess() {
            const message = document.getElementById('whatsapp-message').value;
            const lines = message.split('\n');
            decodedOrder = [];
            let foundProducts = false;

            lines.forEach(line => {
                const trimmedLine = line.trim();
                if (trimmedLine) {
                    const item = decodeLine(trimmedLine);
                    if (item) {
                        decodedOrder.push(item);
                        foundProducts = true;
                    }
                }
            });

            renderOrderTable();

            const statusMessage = document.getElementById('status-message');
            const downloadButton = document.getElementById('download-button');

            if (foundProducts) {
                const errors = decodedOrder.filter(item => item.validation.includes('ERROR'));
                if (errors.length > 0) {
                    statusMessage.className = 'mt-3 text-sm font-semibold error-message';
                    statusMessage.textContent = `Decodificación completada con ${errors.length} errores. ¡Revisar la tabla!`;
                    downloadButton.disabled = true;
                } else {
                    statusMessage.className = 'mt-3 text-sm font-semibold text-green-600';
                    statusMessage.textContent = 'Decodificación exitosa. Pedido listo para su validación.';
                    downloadButton.disabled = false;
                }
            } else {
                statusMessage.className = 'mt-3 text-sm font-semibold text-gray-500';
                statusMessage.textContent = 'No se encontraron códigos de producto en el mensaje.';
                downloadButton.disabled = true;
            }
        }

        // Función para renderizar la tabla HTML
        function renderOrderTable() {
            const tableBody = document.getElementById('order-table-body');
            tableBody.innerHTML = ''; // Limpiar la tabla

            if (decodedOrder.length === 0) {
                tableBody.innerHTML = '<tr id="initial-row"><td colspan="4" class="px-6 py-4 text-sm text-gray-500 text-center">Aún no hay un pedido decodificado.</td></tr>';
                return;
            }

            decodedOrder.forEach(item => {
                const row = document.createElement('tr');
                const validationColor = item.validation.includes('ERROR') ? 'text-red-600 font-bold' : 'text-green-600';

                row.innerHTML = `
                    <td class="whitespace-nowrap py-4 pl-4 pr-3 text-sm font-medium text-gray-900 sm:pl-6">${item.sku}</td>
                    <td class="whitespace-normal px-3 py-4 text-sm text-gray-500">${item.desc} ($${item.price.toFixed(2)})</td>
                    <td class="whitespace-nowrap px-3 py-4 text-sm text-gray-500">${item.quantity}</td>
                    <td class="whitespace-nowrap px-3 py-4 text-sm ${validationColor}">${item.validation}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Función para descargar el archivo CSV
        function downloadCSV() {
            if (decodedOrder.length === 0) {
                alert("No hay un pedido decodificado para descargar.");
                return;
            }

            const clientName = document.getElementById('client-name').value.trim() || 'CLIENTE_DESCONOCIDO';
            
            // Columnas requeridas para el sistema de importación
            const headers = ["CLIENTE", "CODIGO", "CANTIDAD", "PRECIO_UNITARIO", "VALIDACION"];
            
            // Reemplaza comas y saltos de línea en el nombre del cliente para evitar problemas en el CSV
            const safeClientName = clientName.replace(/,/g, '').replace(/\n/g, ' ');

            let csvContent = headers.join(",") + "\n";
            
            decodedOrder.forEach(item => {
                const row = [
                    safeClientName,
                    item.sku,
                    item.quantity,
                    item.price.toFixed(2), // Formato de precio con 2 decimales
                    item.validation.replace(/,/g, '') // Asegurar que el campo de validación no tenga comas
                ];
                csvContent += row.join(",") + "\n";
            });

            // Crear y descargar el archivo CSV
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.setAttribute('href', url);
            
            const now = new Date();
            const dateStr = now.toISOString().slice(0, 10).replace(/-/g, ''); // YYYYMMDD
            // Crea un nombre de archivo seguro
            const safeFilenamePart = safeClientName.substring(0, 15).replace(/\s/g, '_').replace(/[^a-zA-Z0-9_]/g, '');
            link.setAttribute('download', `Pedido_${dateStr}_${safeFilenamePart}.csv`);
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            alert(`Plantilla CSV descargada exitosamente para el cliente: ${clientName}`);
        }
    </script>

</body>
</html>
```
